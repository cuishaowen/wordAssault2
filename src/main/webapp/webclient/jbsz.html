<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="keywords" content="">
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no,minimum-scale=1.0,maximum-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="format-detection" content="email=no" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1,IE=edge" />
    <title>信息设置</title>
    <link rel="stylesheet" href="layui/css/layui.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<style>
    .layui-bg-green{background-color:#1d8183!important;}
    .layui-nav-item{cursor: pointer;width:10%;text-align: center;}
    .layui-nav{min-width: 1360px;}
    .layui-nav * { font-size: 16px;}
    .layui-form-label span{color:red;font-size: 20px;}
</style>
<body class="bgbody">
<ul class="layui-nav layui-bg-blue">
    <div class="logobg">
        <img class="logo" src="images/logo.png">
    </div>
    <li class="layui-nav-item "><a href="index.html">音标</a></li>
    <li class="layui-nav-item "><a href="dcxl.html">单词突击</a></li>
    <li class="layui-nav-item"><a href="llkNew.html">连连看</a></li>
    <!--<li class="layui-nav-item"><a href="dchg.html">单词回顾</a></li>-->
    <li class="layui-nav-item"><a href="chl.html">刷题测试</a></li>
    <li class="layui-nav-item"><a href="yftj.html" >语法突击</a></li>
    <li class="layui-nav-item"><a href="xxbg.html">学习报告</a></li>
    <li class="layui-nav-item tc" lay-unselect="">
        <a href="javascript:;">
            <img src="images/20150607110911_kY5cP.jpeg" class="layui-nav-img">
            <strong id="loginUserName">请输入名字</strong></a>
        <dl class="layui-nav-child">
            <dd><a href="jbsz.html">个人设置</a></dd>
            <dd><a href="#" onclick="loginOut()">退出登陆</a></dd>
        </dl>
    </li>
</ul>
<div class="bg">
    <div class="bg-content">
        <div class="bg-left">
            <div class="tx">
                <img class="tx-img" src="images/20150607110911_kY5cP.jpeg" alt="">
                <div class="nickname">
                    <strong id="userName"></strong>同学
                    <p>您是第<strong class="red" id="num"></strong>位学员</p>
                    <p>欢迎您第<strong class="red" id="loginTimes"></strong>次登陆系统</p>
                </div>

            </div>

            <div class="gm">

                <div class="gm-kc">
                    <ul>
                        <li>用户设置<i></i></li>

                    </ul>
                </div>
            </div>
        </div>
        <div class="bg-right">
            <div class="bg-title">
                <span style="background:url('images/gr.png')no-repeat center;background-size:100% 100%;width:20px;"></span> 用户信息设置
            </div>
            <div class="bg3">
                <form class="layui-form layui-form-pane" action="">
                    <div class="layui-form-item">
                        <label class="layui-form-label">卡号</label>
                        <div class="layui-input-block">
                            <input type="text" id="kahao" name="title" lay-verify="title" disabled="disabled" autocomplete="off" placeholder="系统自动读取" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">姓名</label>
                        <div class="layui-input-block">
                            <input type="text" name="title" id="name" lay-verify="title"  autocomplete="off" placeholder="请输入" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">用户名 <span>*</span></label>
                        <div class="layui-input-block">
                            <input type="text" name="title" id="loginName" lay-verify="title"  autocomplete="off" placeholder="请输入" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">密码 <span>*</span></label>
                        <div class="layui-input-block">
                            <input type="text" name="title" id="newPassword" lay-verify="title"  autocomplete="off" placeholder="请输入" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <button type="button" onclick="updatePassword()" class="layui-btn layui-btn-sm">修改密码</button>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">性别</label>
                        <div class="layui-input-block">
                            <input type="radio" name="sex" value="1" title="男" >
                            <input type="radio" name="sex" value="2" title="女">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">软/硬键盘</label>
                        <div class="layui-input-block">
                            <input type="radio" name="jpanType" value="1" title="软键盘">
                            <input type="radio" name="jpanType" value="2" title="硬键盘">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">发音</label>
                        <div class="layui-input-block">
                            <input type="radio" name="mapType" value="1" title="英式发音">
                            <input type="radio" name="mapType" value="2" title="美式发音">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">播放间隔</label>
                        <div class="layui-input-block">
                            <select name="interest" lay-filter="aihao">
                                <option value=""></option>
                                <option value="0">2秒</option>
                                <option value="1" selected="">3秒</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">手机号码</label>
                        <div class="layui-input-block">
                            <input type="text" id="phone" name="title" lay-verify="title"  autocomplete="off" placeholder="请输入" class="layui-input">
                        </div>
                    </div>
                </form>
            </div>
            <div class="bg4">
                <div class="bg4-tx">
                    <div class="tx1">
                        <div class="tx-title">
                            系统头像
                        </div>
                        <div class="tx-img1">
                            <img src="images/20150607110911_kY5cP.jpeg" alt="">
                            <img src="images/3.png" alt="">
                            <img src="images/cha1.png" alt="">
                            <img src="images/221.png" alt="">
                            <img src="images/2.png" alt="">
                            <img src="images/21.png" alt="">
                        </div>
                    </div>
                    <div class="tx2">
                        <img src="" alt="">
                    </div>
                </div>
                <form class="layui-form layui-form-pane" action="">
                    <div class="layui-form-item">
                        <label class="layui-form-label">学校</label>
                        <div class="layui-input-block">
                            <input type="text" id="xuexiao" name="title" lay-verify="title"  autocomplete="off" placeholder="请输入" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">城市</label>
                        <div class="layui-input-block">
                            <input type="text" id="city" name="title" lay-verify="title"  autocomplete="off" placeholder="请输入" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">微信</label>
                        <div class="layui-input-block">
                            <input type="text" id="weixin" name="title" lay-verify="title"  autocomplete="off" placeholder="请输入" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">班级</label>
                        <div class="layui-input-block">
                            <input type="text" id="banji" name="title" lay-verify="title"  autocomplete="off" placeholder="请输入" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">省份</label>
                        <div class="layui-input-block">
                            <input type="text" id="province" name="title" lay-verify="title"  autocomplete="off" placeholder="请输入" class="layui-input">
                        </div>
                    </div>
                </form>
            </div>

            <div class="bg5">
                <button type="button" onclick="updateUserInfo()" class="layui-btn">保存</button>
            </div>
        </div>
    </div>
</div>
</body>
<script src="layui/layui.js"></script>
<script src="js/jquery-2.1.4.js"></script>
<script src="../static/common/website.js"></script>
<script src="js/common.js"></script>
<script>
    layui.use('element', function(){
        var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块

        //监听导航点击
        element.on('nav(demo)', function(elem){
            //console.log(elem)
            layer.msg(elem.text());
        });
    });
    function sp(){
        $('.bg').height($(window).height() - 120);
        $('.gm').height($('.bg-left').height() - 300);
        $('.gm-kc').height($('.gm').height() - 71);
        $('.layui-tab-content').height($('.bg-right').height() - 132)
        $('.bg3,.bg4').height($('.bg-right').height()-117)
    };
    sp();
    window.onresize = sp;
    $(document).on('click','.gm-kc ul li',function(){
        $(this).css('background-color','#E7F5FC');
        $(this).siblings().css('background-color','#fff');
        $(this).find('i').css({'background':'url(images/221.png)no-repeat center','background-size':'100% 100%'})
        $(this).siblings().find('i').css({'background':'url(images/ico8.png)no-repeat center','background-size':'100% 100%'})
    });
    $('.tx-img1 img').on('click',function(){
        var a = $(this).attr("src");

        $('.tx2 img').attr('src',a);
    })
</script>
<script>
    layui.use(['form', 'layedit', 'laydate', 'laypage', 'layer'], function () {
        var form = layui.form
            , layer = layui.layer
            , layedit = layui.layedit
            , laydate = layui.laydate
            , laypage = layui.laypage;
    });

</script>
<script>
    getUserInfo();

    //修改个人信息
    function updateUserInfo() {
        var name = $('#name').val();
        var xuexiao=$('#xuexiao').val();
        var city=$('#city').val();
        var province=$('#province').val();
        var weixin=$('#weixin').val();
        var banji=$('#banji').val();
        var phone=$('#phone').val();
        var sex=$("input[name='sex']:checked").val();
        var jpanType=$("input[name='jpanType']:checked").val();
        var mapType=$("input[name='mapType']:checked").val();
        $.ajax({
            type:'post',
            url: getContextPath() +"/enguser/enguser/updateUserInfo",
            cache:false,
            async:false,
            data:{xuexiao:xuexiao,province:province,city:city,weixin:weixin,banji:banji,phone:phone,sex:sex,jpanType:jpanType,mapType:mapType,name:name},
            success:function (data) {
                if (data.code==0){
                    layer.open({
                        content: '修改成功',
                        yes: function(index, layero){
                            getSession();
                            window.location.reload();
                        }
                    });
                }else{
                    layui.use(['layer'], function () {
                        var layer = layui.layer;
                        layer.msg(data.msg);
                    });
                }
            },
            error:function () {
                alert("操作失败,请练习客服");
            }
        });
    }

    //修改密码
    function updatePassword() {
        var loginName=  $('#loginName').val();
        var newPassword=  $('#newPassword').val();
        var url = getContextPath() +"/enguser/enguser/updatePassword"
            ,data ={loginName:loginName,newPassword:newPassword};
        $.post(url,data,function (res) {
            if (res.code==0) {
                layer.open({
                    content: '密码修改成功，请重新登录',
                    yes: function(index, layero){
                        window.location.href = "Login.html";
                    }
                });
            }else{
                layui.use(['layer'], function () {
                    var layer = layui.layer;
                    layer.msg(res.msg);
                });
            }
        });
    }

    //获取用户的基本信息进行展示
    function getUserInfo() {
        $.ajax({
            "url" : getContextPath() +"/enguser/enguser/getUserInfo",
            "method" : "POST",
            "cache" : false,
            "async" : false
        }).success(function(data){
            if (data.code==1){
                //未能获取到用户信息，跳转至登录页面，重新登录
                window.location.href="Login.html";
            } else {
                console.log(data);
                $('#name').val(data.name);
                $('#kahao').val("ZHS"+data.kahao);
                $('#xuexiao').val(data.xuexiao);
                $('#city').val(data.city);
                $('#province').val(data.province);
                $('#weixin').val(data.weixin);
                $('#banji').val(data.banji);
                $('#phone').val(data.phone);
                $("input[name='sex']").val([data.sex]);
                $("input[name='jpanType']").val([data.jPanType]);
                $("input[name='mapType']").val([data.mp3Type]);
            }
        });
    }
</script>
</html>